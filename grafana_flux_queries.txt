# Grafana Flux Queries & Panel Design for Smart Library (Student View)

# --- Instructions ---
# 1. In your Grafana dashboard, click "Add panel".
# 2. For each panel described below, select the correct "Visualization" type.
# 3. Copy the "Panel Title".
# 4. Paste the corresponding Flux query into the query editor.
# 5. Apply the "Key Options" using the panel editor on the right.
# 6. Save the panel and arrange it on your dashboard.

# --- Dashboard Settings ---
# Title: Library Status
# Default Time Range: Last 15 minutes
# Auto-Refresh: 10s

# --- Panel 1: Library Occupancy ---
# Visualization: Gauge
# Panel Title: Library Occupancy
# Key Options:
# - Under "Gauge" settings, set "Max" to 50. (This is the assumed total capacity).
# Query:
from(bucket: "my-bucket")
  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
  |> filter(fn: (r) => r._measurement == "SensorReadings" and r._field == "people_count")
  |> last()

# --- Panel 2: Current Temperature ---
# Visualization: Stat
# Panel Title: Current Temperature
# Key Options:
# - Standard options -> Unit: Temperature -> Celsius (Â°C)
# Query:
from(bucket: "my-bucket")
  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
  |> filter(fn: (r) => r._measurement == "SensorReadings" and r._field == "temperature")
  |> last()

# --- Panel 3: Indoor Air Quality (IAQ) ---
# Visualization: Stat
# Panel Title: Indoor Air Quality
# Key Options:
# - Standard options -> Unit: Misc -> Percent (0-100)
# - Thresholds: Base=Green, 50=Orange, 75=Red. (Lower is better).
# Query:
from(bucket: "my-bucket")
  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
  |> filter(fn: (r) => r._measurement == "SensorReadings" and r._field == "iaq")
  |> last()

# --- Panel 4: Light Level ---
# Visualization: Stat
# Panel Title: Light Level
# Key Options:
# - Standard options -> Unit: Brightness -> Lux (lx)
# Query:
from(bucket: "my-bucket")
  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
  |> filter(fn: (r) => r._measurement == "SensorReadings" and r._field == "light_level")
  |> last()

# --- Panel 5: Noise Level ---
# Visualization: Stat
# Panel Title: Noise Level
# Key Options:
# - Standard options -> Unit: Sound -> Decibel (dB)
# Query:
from(bucket: "my-bucket")
  |> range(start: v.timeRangeStart, stop: v.timeRangeStop)
  |> filter(fn: (r) => r._measurement == "SensorReadings" and r._field == "noise_db")
  |> last()